<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Matrix Live Data Stream</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <canvas id="matrix"></canvas>

  <div id="debugOverlay" class="debug hidden" aria-live="polite"></div>
  <div id="tooltip" class="tooltip hidden"></div>

  <!-- Settings HUD (toggle with S) -->
  <div id="hud" class="hud hidden" role="dialog" aria-label="Inställningar">
    <div class="hud__row">
      <div class="hud__title">Matrix stream</div>
      <button id="hudClose" class="hud__btn" type="button" title="Stäng (S)">×</button>
    </div>

    <div class="hud__grid2">
      <label class="hud__label">
        API-bas (t.ex. https://acurve…/api/v1/)
        <input id="baseUrl" class="hud__input" placeholder="https://acurve.kappala.se:50001/api/v1/" />
      </label>

      <label class="hud__label">
        Bearer token (utan "Bearer ")
        <input id="token" class="hud__input" placeholder="ff2d…" />
      </label>
    </div>

    <div class="hud__grid">
      <label class="hud__label">
        Läge
        <select id="mode" class="hud__select">
          <option value="poll" selected>Poll: /MeasurementMulti</option>
          <option value="demo">Demo (lokal data)</option>
        </select>
      </label>

      <label class="hud__label">
        Poll-intervall (ms)
        <input id="pollMs" class="hud__input" type="number" min="200" step="100" value="600000" />
      </label>

      <label class="hud__label">
        Taggar per request
        <input id="chunkSize" class="hud__input" type="number" min="1" max="10" step="1" value="10" />
      </label>

      <label class="hud__label">
        Teckenuppsättning
        <select id="charset" class="hud__select">
          <option value="matrix">Matrix (katakana + siffror)</option>
          <option value="digits">Siffror (0–9)</option>
          <option value="hex">Hex (0–9, A–F)</option>
        </select>
      </label>

      <label class="hud__label">
        Intensitet (spår)
        <input id="trail" class="hud__input" type="number" min="0.02" max="0.30" step="0.01" value="0.08" />
      </label>

      <label class="hud__label">
        Hastighet (0.2–1.5)
        <input id="speed" class="hud__input" type="number" min="0.2" max="1.5" step="0.1" value="0.6" />
      </label>

      <label class="hud__label">
        Queue-repeat (1–10)
        <input id="repeat" class="hud__input" type="number" min="1" max="10" step="1" value="6" />
      </label>

      <label class="hud__label">
        ReturnTimeStampType
        <select id="tsType" class="hud__select">
          <option value="LOCAL">LOCAL</option>
          <option value="UTC">UTC</option>
        </select>
      </label>

      <div></div>
    </div>

    <label class="hud__label">
      Taggar (en per rad)
      <textarea id="tags" class="hud__textarea" rows="6" placeholder="TagName1&#10;TagName2"></textarea>
    </label>

    <div class="hud__grid">
      <label class="hud__label">
        StartTime (YYYY-MM-DD HH:mm)
        <input id="startTime" class="hud__input" placeholder="2023-01-05 00:00" />
      </label>

      <label class="hud__label">
        EndTime (YYYY-MM-DD HH:mm)
        <input id="endTime" class="hud__input" placeholder="2023-01-05 12:00" />
      </label>

      <label class="hud__label">
        ResolutionType
        <select id="resType" class="hud__select">
          <option value="s">s</option>
          <option value="m" selected>m</option>
          <option value="h">h</option>
          <option value="d">d</option>
        </select>
      </label>

      <label class="hud__label">
        ResolutionNumber
        <input id="resNum" class="hud__input" type="number" min="1" step="1" value="10" />
      </label>
    </div>


    <div class="hud__grid">
      <label class="hud__label">
        Senaste-läge
        <select id="timeMode" class="hud__select">
          <option value="manual" selected>Manuell (använd fälten Start/End)</option>
          <option value="latest">Strömmande: senaste värdet (rullande fönster)</option>
        </select>
      </label>

      <label class="hud__label">
        Fönster bakåt (minuter)
        <input id="lookbackMin" class="hud__input" type="number" min="1" step="1" value="10" />
      </label>
    </div>

    <div class="hud__grid">
      <label class="hud__label">
        Hämtning
        <select id="fetchMode" class="hud__select">
          <option value="window" selected>Fönster (Start–End)</option>
          <option value="point">En punkt (Start=End, senaste minut)</option>
        </select>
      </label>
      <div></div>
    </div>

    <div class="hud__actions">
      <button id="btnLoadTags" class="hud__action" type="button">Hämta /Tag</button>
      <button id="btnTestMeas" class="hud__action" type="button">Testa /MeasurementMulti</button>
    </div>

    <div class="hud__help">
      <label class="hud__hint" style="display:flex;align-items:center;gap:10px;">
        <input id="showDebug" type="checkbox" />
        Visa debug overlay
      </label>
      <label class="hud__hint" style="display:flex;align-items:center;gap:10px;">
        <input id="headLock" type="checkbox" checked />
        Lås första tecknet från data
      </label>
      </label>

      <div id="apiStatus" class="hud__status">API: (ej testad ännu)</div>
      <div class="hud__hint"><kbd>S</kbd> inställningar · <kbd>F</kbd> fullscreen · <kbd>Space</kbd> pausa</div>
      <div class="hud__hint"><b>Obs:</b> Om du kör från GitHub Pages kan CORS blockera anropet — då behövs proxy.</div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
